<!--
    docs/g10.code_style.md
    Generated: 2025-12-16
-->

# G10 Workspace Code Style Guide ‚öôÔ∏è

**Location:** `docs/g10.code_style.md`

## Purpose & Scope üéØ

This guide documents the code style, conventions, and recommended tooling for all projects in the `g10` workspace (including `g10`, `g10-asm`, `g10-link`, etc.). Follow this guide to keep the codebase consistent, readable, and maintainable.

---

## 1. High-level goals ‚úÖ
- Consistency across projects
- Readability and explicitness (favor clarity over cleverness)
- Safety: prefer type-safety, avoid undefined behavior
- Automation: use formatters & linters enforced by CI

---

## 2. Language & Tooling üîß
- Standard: **C++20** (use modern features sensibly)
- Formatting: use **clang-format** (LLVM or Google base with customizations).
- Static analysis: run **clang-tidy** with modernize, performance, readability checks.
- Testing: use a unit test framework (Catch2 or GoogleTest) and put tests under `tests/`.
- Build: continue using `Makefile` / `premake5.lua` as the project currently does.

---

## 3. File headers & documentation üìù
- Every source/header file MUST have a file header like existing files:

```cpp
/**
 * @file    g10/module.hpp
 * @author  Name
 * @date    YYYY-MM-DD
 *
 * @brief   Short description.
 */

#pragma once
```

- Public APIs and non-trivial functions MUST have Doxygen-style comments (`@brief`, `@param`, `@return`).
- Keep comments factual and concise; use them to explain `why` (not `what` when the code is clear).

---

## 4. Naming Conventions üî§
- **Namespaces:** lower-case, short: `g10` (already used).
- **Classes / Structs:** follow existing project convention: singular nouns with lower-case identifiers (e.g., `cpu`, `bus`, `register_file`). Be consistent across workspace.
- **Functions:** snake_case (e.g., `read_irq0`, `consume_machine_cycles`). Use verbs for functions.
- **Variables:** snake_case; member variables prefixed with `m_` (e.g., `m_regs`).
- **Constants / constexpr:** UPPER_SNAKE for compile-time constants (e.g., `IVT_START`), or `kCamelCase` if preferred‚Äîbe consistent.
- **Enums:** prefer `enum class` for type safety. Use `enum` (weak) only when bit/flag semantics or legacy patterns require it.
- **Macros:** avoid where possible. Use `constexpr` functions or `inline` helpers instead of function-like macros. Macros for platform exports (e.g., `g10api`) are allowed.

---

## 5. Coding Style & Best Practices üí°
- Use `auto` where it improves readability, but do not hide important types.
- Prefer **explicit** casting only when necessary. Use `static_cast<>` rather than C-style casts.
- Use trailing return types (`auto f() -> type`) as is the existing style.
- Use `constexpr`, `inline`, and `static` appropriately for performance and clarity.
- Use `[[nodiscard]]` on functions where ignored return values are likely errors (e.g., `g10::result` returning helpers).
- Prefer `noexcept` where function is guaranteed not to throw.

---

## 6. Error Handling üõ°Ô∏è
- Prefer explicit error results: use `g10::result` (`std::expected`) for functions that can fail.
- Keep `bool` returns for internal success/failure as used by `cpu` methods when appropriate.
- Use `g10::error` helper for formatted error creation.

---

## 7. Headers & Includes üìö
- Public headers must be self-contained (include everything they need).
- Use forward declarations when possible to minimize compile-time dependencies.
- Group includes in this order: project headers, system headers, third-party headers.
- Keep `#pragma once` at the top of headers (consistent with existing files).

---

## 8. Macros & Inline Helpers ‚ö†Ô∏è
- Replace helper macros (like `#define full_reg(i) ...`) with `constexpr` inline functions or lambdas to improve type safety and debuggability.
- Keep platform/export macros (`g10api`) as is.

---

## 9. Formatting rules (suggestions) üßº
- Indentation: **4 spaces**, no tabs.
- Max line length: **100‚Äì120** characters.
- Brace style: K&R / Allman is acceptable; keep consistent across file. Current project style uses K&R.
- Configure `.clang-format` and commit it to the repo. Example minimal snippet:

```yaml
BasedOnStyle: LLVM
IndentWidth: 4
ColumnLimit: 100
AllowShortFunctionsOnASingleLine: false
```

---

## 10. Testing & CI ‚úÖ
- Each module should have unit tests in `tests/`.
- Add a CI job to run `clang-format --dry-run`/`--Werror`, `clang-tidy`, and unit tests on push/PR.
- Fail the build on style violations.

---

## 11. Git & Commit Messages üì¶
- Use concise, descriptive commit messages. Consider Conventional Commits format (optional): `feat: ...`, `fix: ...`, `chore: ...`.
- Branches named with `feature/`, `fix/`, `chore/` prefixes.

---

## 12. Migration & Enforcement üõ†Ô∏è
- Add `.clang-format` and `clang-tidy` configs at repo root.
- Add pre-commit hook to run `clang-format` and `git add` the formatted files.
    - A sample git hook is provided at `.githooks/pre-commit` and can be
        enabled by running `scripts/setup-git-hooks.sh` which sets
        `core.hooksPath` and makes the hook executable.
- Add CI checks in workflow to enforce style and run tests.

---

## 13. Examples / Templates ‚ú®

**Function doc example**

```cpp
/**
 * @brief   Reads the value of the `IRQ0` hardware register.
 *
 * @return  The low byte of the `IRQ` register.
 */
auto read_irq0 () const -> std::uint8_t;
```

**Prefer**: `auto f() -> type`, `m_` prefix for members, `g10::result` for recoverable errors.

---

## 14. Checklist (for PR reviewers) ‚úÖ
- [ ] File header present and accurate
- [ ] Doxygen comments for public APIs
- [ ] Code formatted with `.clang-format`
- [ ] No new macros unless justified
- [ ] Tests added/updated for behavior changes
- [ ] CI checks pass

---

## Questions / Next Steps
- I recommend adding `.clang-format` and a `clang-tidy` config and a simple CI job to enforce this guide. If you'd like, I can prepare those files and a PR.

---

¬© G10 Project ‚Äî Code Style Guide
